# CodeVerse

import math, cmath

# Global configuration
variables = {}
history = []
degree_mode = False

# Advanced functions
advanced_functions = {
    # Trigonometry
    'sin': lambda x: math.sin(math.radians(x)) if degree_mode else math.sin(x),
    'cos': lambda x: math.cos(math.radians(x)) if degree_mode else math.cos(x),
    'tan': lambda x: math.tan(math.radians(x)) if degree_mode else math.tan(x),
    'asin': lambda x: math.degrees(math.asin(x)) if degree_mode else math.asin(x),
    'acos': lambda x: math.degrees(math.acos(x)) if degree_mode else math.acos(x),
    'atan': lambda x: math.degrees(math.atan(x)) if degree_mode else math.atan(x),

    # General math
    'sqrt': math.sqrt, 'log': math.log, 'log10': math.log10,
    'exp': math.exp, 'abs': abs, 'pow': pow,
    'round': round, 'floor': math.floor, 'ceil': math.ceil,
    'factorial': math.factorial, 'sum': sum, 'len': len,
    'min': min, 'max': max, 'sorted': sorted,
    'range': lambda *a: list(range(*a)),

    # Conversions
    'bin': bin, 'hex': hex, 'int': int, 'float': float,

    # Complex numbers
    'complex': complex,

    # Constants
    'pi': math.pi, 'e': math.e, 'tau': math.tau, 'inf': math.inf, 'nan': math.nan
}

# Add cmath functions
for name in dir(cmath):
    if not name.startswith("_"):
        advanced_functions[f"c_{name}"] = getattr(cmath, name)

def show_functions():
    print("\nðŸ“˜ AVAILABLE FUNCTIONS:")
    print("""
â†’ Trigonometry: sin(), cos(), tan(), asin(), acos(), atan()
â†’ Logarithms: log(x), log10(x), exp(x)
â†’ Rounding: round(x), floor(x), ceil(x)
â†’ Others: sqrt(), pow(x,y), abs(x), factorial(x)
â†’ Lists: sum(), len(), sorted(), min(), max(), range()
â†’ Conversions: bin(), hex(), int(), float()
â†’ Complex numbers: complex(x,y), c_sin(), c_log(), etc.
â†’ Constants: pi, e, tau, inf, nan
â†’ Modes: mode deg / mode rad
â†’ Variables: x = 3+2 â†’ then use x
â†’ History: #1, #2, etc. to reuse expressions
""")

def show_history():
    if not history:
        print("ðŸ”¹ History is empty.")
    else:
        print("\nðŸ“œ History:")
        for i, (expr, res) in enumerate(history[-20:], 1):
            print(f"#{i}: {expr} = {res}")

def evaluate(expr):
    global degree_mode
    expr = expr.strip()

    if expr.lower() == "mode deg":
        degree_mode = True
        print("ðŸ”„ Mode: DEGREES")
        return
    elif expr.lower() == "mode rad":
        degree_mode = False
        print("ðŸ”„ Mode: RADIANS")
        return
    elif expr.lower() == "functions":
        show_functions()
        return
    elif expr.lower() == "history":
        show_history()
        return

    if expr.startswith("#"):
        try:
            index = int(expr[1:]) - 1
            expr = history[index][0]
            print(f"ðŸ” Reusing #{index+1}: {expr}")
        except:
            print("âŒ Error: Invalid history index.")
            return

    if "=" in expr:
        try:
            var, val = map(str.strip, expr.split("=", 1))
            if not var.isidentifier():
                print("âŒ Error: Invalid variable name.")
                return
            result = eval(val, {"__builtins__": None}, {**advanced_functions, **variables})
            variables[var] = result
            history.append((expr, result))
            print(f"âœ… {var} = {result}")
        except Exception as e:
            print(f"âŒ Assignment error: {e}")
        return

    try:
        result = eval(expr, {"__builtins__": None}, {**advanced_functions, **variables})
        history.append((expr, result))
        print(f"= {result}")
    except ZeroDivisionError:
        print("âŒ Error: Division by zero.")
    except NameError:
        print("âŒ Error: Undefined variable or function.")
    except SyntaxError:
        print("âŒ Syntax error.")
    except Exception as e:
        print(f"âŒ Error: {e}")

def main():
    print("\nðŸ§  EXTREME SCIENTIFIC CALCULATOR")
    print("Type 'functions' to view available functions.")
    print("Type 'exit' to quit.\n")
    while True:
        try:
            user_input = input(">> ").strip()
            if user_input.lower() in ["exit", "quit", "salir"]:
                print("ðŸ‘‹ Goodbye.")
                break
            if user_input:
                evaluate(user_input)
        except (KeyboardInterrupt, EOFError):
            print("\nðŸ‘‹ Session ended.")
            break

if __name__ == "__main__":
    main(
